### Adding Recipients to a Bulk SMS Campaign
{{EXAMPLE_QUERY}}

Only recipient data of one type is allowed in one request:

- list of numbers/ID contact cards/contact IDs
- list of group IDs from the contact book
- file with recipient list.

Attempting to transmit multiple different types of recipients at once will return an error {{API_INCORRECT_PARAM}}.
If you need to add recipients from multiple sources to one campaign, this should be done in several requests.

When adding recipient numbers, contacts, or contact cards, the maximum number of recipients uploaded in one request
cannot exceed 500 numbers. If the limit is exceeded, an error {{API_INCORRECT_PARAM}} will be returned and
the recipients will not be added.

To upload any desired number of contacts to one campaign, you should split the list into portions of 500 or fewer
and upload each portion with a separate API call – recipients will be added to the existing list,
unless the parameter **replace=1** is specified.

Uploading numbers, contacts, and cards is done in the main thread of the web server and returns the result for each
processed recipient as an array (see the format of the returned data below).

Uploading from a contact group or file creates a background task (asynchronous upload) and returns
its ID for further status tracking. In this case, the API response code will be {{API_BACKGROUND_WAIT}}.

Recipient numbers must be transmitted in international format. All extraneous characters will be removed from the number automatically.

Each number is checked for the possibility of sending a message to it by the country and operator code to which it belongs.

All numbers that fail the check will be rejected with an appropriate error code (code), and for each added
number, the ID of the created message (messageId) will be returned for the possibility of subsequent status requests.

If not all transmitted recipients were added (errors occurred), the API may return one of two response codes:

- {{API_PARTIALLY_DONE}} - if not all recipients were added, but at least one recipient passed the check
- {{API_NOTHING_DONE}} - if no recipients passed the check.

For the entire time recipients are being added, the campaign is blocked from being added by other processes, so parallel addition in several threads to one campaign is impossible.

#### Request Parameters

| Parameter            | Type          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `id`                | integer      | Campaign identifier to which recipients need to be added                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `recipients`        | array string | For regular mailings (without using placeholder variables in the text), recipients can be transmitted as:<br><ul><li>a string with recipient numbers separated by commas or line breaks;</li><li>a one-dimensional array where each array element corresponds to one recipient number;</li><li>a two-dimensional array where each element is an array containing an element with the `recipient` key and the recipient number as the value.</li></ul>For template mailings, recipients must be transmitted as a two-dimensional array, where each element is an array containing an element with the `recipient` key and the recipient number as the value. Also, this array may contain elements with keys corresponding to the names of variables (placeholders) in the SMS text (without the surrounding curly brackets).<br>In this case, if some of the placeholders contained in the text are not transmitted in the data array, processing will occur depending on the value passed in the `params[placeholdersFlag]` parameter (see the description of this parameter below). |
| `recipientContacts` | array string | An array or string of contacts from the contact book separated by commas or line breaks. A contact can be specified as: <ul><li>card ID. In this case, the value of the 'mobile phone number' field marked as the field for mailings will be used for the mailing;</li><li>{card ID}:{card field key} (e.g., 123456:mobile if the mobile phone field in your book has the 'mobile' key). The value of the specified card field will be used for the mailing.</li></ul> If the mailing is template-based, data for filling in the placeholders in the text will be used from the corresponding contact card.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `recipientGroups`   | array string | An array or string of group IDs from the contact book separated by commas or line breaks, from which the campaign will be formed. If the same contact is contained in multiple groups, it will only be added to the campaign once. If multiple contacts contain the same phone number, only the first one will be added.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `recipientsFile`    | file         | Uploaded file object with recipients – **CSV** or **Excel** (only **XLS**) file with recipient numbers in international format.<br>For regular mailings (without using placeholder variables in the text) – numbers one per line.<br>For template mailings – numbers one per line in one of the columns with the header `recipient`, with other columns possibly containing data for substitution in the placeholders. The headers of such columns (in the first row of the table) must strictly correspond to the placeholders in the SMS text (without the surrounding curly brackets, considering case sensitivity). Placeholder names are only allowed to contain Latin letters and numbers, as well as '`_`', '`-`'. If there are columns with the same headers, an error will be returned.<br>In this case, if there are no corresponding columns for any of the placeholders contained in the text, processing will occur depending on the value passed in the `params[placeholdersFlag]` parameter (see the description of this parameter below).                                                         |
| `params`            | array        | Additional settings (see the table [Additional Settings](#add-recipients-params)).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

#####  <span data-anchor="add-recipients-params">Additional Settings</span>

| Parameter                           | Type     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `params[replace]`                  | integer | Indicates whether to remove all already added recipients and start adding again:<br>**0** - no, add recipients to those already added previously (default value);<br>**1** - yes, remove all previously added recipients before adding new ones;                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `params[placeholdersFlag]`         | integer | Processing of missing variables (placeholders) for template mailings.<br>If some values of variables for substitution in the text are not found, one of the following behaviors is possible:<br>**1** - the message is added to the mailing, but the placeholders remain in the text as is, no replacement occurs (default behavior);<br>**2** - the message is added, and the placeholders are removed (this can be useful if you use curly brackets in the text and do not want them to be removed when sending);<br>**3** - the message is rejected with an error indicating missing data for substitution in the text.                                                                      |
| `params[recipientsFileEncoding]`   | string  | Encoding of the file with recipient data. Available encodings: **KOI8-R, CP866, WINDOWS-1252, WINDOWS-1251, UTF-8, ASCII, ISO-8859-1, UCS-2**. Default: **UTF-8**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `params[recipientsFileSkipHeader]` | integer | Indicates whether to skip the first line of the file and start processing from the second. Useful if the recipient upload is from a file where the first line contains column names. In this case, it is better to skip the first line and start processing the file from the second line. Possible values:<br>**0** - start from the first line (default value);<br>**1** - skip the first line of the file and start processing from the second (forcibly set for template mailings);<br>In the case of template mailings, the value of this parameter is always **1** and cannot be overridden, as the first line should contain the names of the variables for substitution. |
| `params[recipientsFileDelimiter]`  | string  | Column delimiter in the file with recipient data, default: **,** (comma). If necessary, you can use any other character.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `params[recipientsFileEnclosure]`  | string  | Text enclosure character in the file with recipient data, default: **'** (single quote). This character should enclose text on both sides in columns containing the delimiter character so that the system can correctly parse the file into columns.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

#### Server Response

array | integer: When loading recipients from a list of numbers, contacts, or contact cards, an array is returned, each element of which contains data about the uploaded recipients:

| Field        | Type     | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-------------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `recipient` | string  | Recipient number being added to the campaign                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `code`      | integer | Recipient addition result code:<br>**0** - number successfully added to the campaign<br>**1** - no phone number or its value is empty in the transmitted data<br>**2** - no phone number found in the transmitted data (most likely the data is incorrectly formatted)<br>**3** - number does not conform to the international phone number format<br>**4** - number has already been added to the campaign (duplicates excluded from the mailing)<br>**5** - number is in the stop list (this can be either your stop list or the system's stop list)<br>**6** - sending to the destination country is restricted by your account settings<br>**7** - it is impossible to determine the operator and/or destination country<br>**8** - the system does not support sending to this operator, contact our support for clarification<br>**20** - the transmitted data does not contain all the necessary placeholders (if `placeholdersFlag` is set to `1`)<br>**30** - contact card not found in the contact book (`recipient` will be `null`)<br>**31** - contact card does not contain a mobile number (`recipient` will be `null`)<br>**32** - contact not found in the contact book (`recipient` will be `null`)<br>**51** - for technical reasons, it is currently impossible to create a short link<br>**99** - system error when adding recipient number |
| `messageId` | integer | ID of the added message, if the number was added, the status of the message can be obtained using the specified ID.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `number`    | integer | The original value of the recipient number transmitted by the user (if the recipient number was transmitted)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `contact`   | integer | The ID of the transmitted contact (if `recipientContacts` were transmitted)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

When loading a file with recipients or a list of contact groups, a numeric identifier of the background task of adding recipients is returned. For details on working with background tasks, see [here](/en/help/api-docs/taskqueue).

#### Error Codes

Code                      | Description
-------------------------|----
{{API_VALIDATION}}       | If any parameters contain incorrect values.
{{API_RECORD_NOT_FOUND}} | If the campaign with the specified ID is not found.
{{API_DATA_UPDATE}}      | If the specified campaign is locked by another recipient addition process or the campaign status does not allow recipient addition.
{{API_INCORRECT_PARAM}}  | If no recipient type is specified or multiple recipient types are specified in one request.
{{API_PARTIALLY_DONE}}   | If not all transmitted recipients were added to the campaign.
{{API_NOTHING_DONE}}     | If no recipient was added to the campaign as a result of the request.
{{API_BACKGROUND_WAIT}}  | If a background task for adding recipients was started. For details on working with background tasks, see [here](/en/help/api-docs/taskqueue).

#### Examples

##### Adding recipient numbers to a bulk mailing.
To add a list of recipients to a mailing, you can pass their array like this:

```
recipients[]=380971112233&recipients[]=79101112233&recipients[]=77071112233
```

or like this:

```
recipients=380971112233,79101112233,77071112233
```

Both forms of writing are identical.

##### Adding data for template mailing.

Assume the SMS text is as follows: `Hello, {name}! Your balance as of {date} is {balance}{currency}.`
In this case, the `recipients` parameter should contain data of the following type:

```
recipients[0][recipient]=380971112233
&recipients[0][name]=%D0%92%D0%B0%D1%81%D0%B8%D0%BB%D0%B8%D0%B9
&recipients[0][date]=26.10.17
&recipients[0][balance]=123.45
&recipients[0][currency]=%D0%B3%D1%80%D0%BD
&recipients[1][recipient]=380971112255
&recipients[1][name]=%D0%9E%D0%BB%D1%8C%D0%B3%D0%B0
&recipients[1][date]=26.10.17
&recipients[1][balance]=3222.99
&recipients[1][currency]=%D1%80%D1%83%D0%B1
&recipients[2][recipient]=4901122211112
&recipients[2][name]=Markus
&recipients[2][date]=26.10.17
&recipients[2][balance]=555.45
&recipients[2][currency]=eur
```


All data in the fields transmitted to the server in the HTTP request must be pre-encoded in a URL encoded string (there is a corresponding function for this in each programming language).
